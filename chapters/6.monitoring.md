---
title: Мониторинг и диагностика

readPrev:
  to: /path/to/prev
  label: Предыдущий раздел

nextRead:
  to: /path/to/next
  label: Следующий раздел
---

### Мониторинг и диагностика

Для обеспечения бесперебойной работы Портала разработчика требуется соблюдать ряд мер по мониторингу и диагностике. Администратору Комплекса следует своевременно выявлять отклонения в работе служб, предотвращать потерю данных и оперативно реагировать на сбои.

В данной главе приведены рекомендации по обеспечению устойчивого функционирования Комплекса, включая правила хранения постоянных данных, создание резервных копий и настройку системы мониторинга.

### Расположение программного обеспечения и журналов событий

Поскольку работа Комплекса развёрнута в изолированных контейнерах Docker, для мониторинга состояния компонентов и выявления сбоев реализовано централизованное логирование через стандартный поток вывода (stdout) каждого контейнера. Это позволяет фиксировать события выполнения и обеспечивать оперативный доступ к журналам.

Для получения информации о состоянии запущенных контейнеров и анализа логов используются стандартные команды Docker. В таблице 9 приведён перечень типовых команд и описание их выводов.

Таблица 9 – Типовые команды управления контейнерами Docker


| Команда Docker | Назначение | Описание вывода |
| -------------- | ---------- | --------------- |
| docker ps | Выводит список всех запущенных контейнеров Docker | Выводы (по умолчанию):<br>CONTAINER ID: Уникальный идентификатор контейнера (хеш);<br>IMAGE: Имя образа, из которого был создан контейнер;<br>COMMAND: Команда, которая выполняется внутри контейнера;<br>CREATED: Время, прошедшее с момента создания контейнера.<br>STATUS: Текущий статус контейнера (например, “Up 5 seconds”, “Exited (0) 2 hours ago”).<br>PORTS: Опубликованные порты (если есть)<br>NAMES: Имя контейнера (заданное пользователем или сгенерированное Docker) |
| docker ps -a или docker ps --all | Выводит список всех контейнеров, включая остановленные | Выводы (по умолчанию):<br>CONTAINER ID: Уникальный идентификатор контейнера (хеш);<br>IMAGE: Имя образа, из которого был создан контейнер;<br>COMMAND: Команда, которая выполняется внутри контейнера;<br>CREATED: Время, прошедшее с момента создания контейнера.<br>STATUS: Текущий статус контейнера (например, “Up 5 seconds”, “Exited (0) 2 hours ago”).<br>PORTS: Опубликованные порты (если есть)<br>NAMES: Имя контейнера (заданное пользователем или сгенерированное Docker) |
| docker ps -l или docker ps --latest | Показывает только последний созданный контейнер (запущен или нет) | Выводы (по умолчанию):<br>CONTAINER ID: Уникальный идентификатор контейнера (хеш);<br>IMAGE: Имя образа, из которого был создан контейнер;<br>COMMAND: Команда, которая выполняется внутри контейнера;<br>CREATED: Время, прошедшее с момента создания контейнера.<br>STATUS: Текущий статус контейнера (например, “Up 5 seconds”, “Exited (0) 2 hours ago”).<br>PORTS: Опубликованные порты (если есть)<br>NAMES: Имя контейнера (заданное пользователем или сгенерированное Docker) |
| docker ps -q | Выводит только идентификаторы контейнеров | Выводы (по умолчанию):<br>CONTAINER ID: Уникальный идентификатор контейнера (хеш);<br>IMAGE: Имя образа, из которого был создан контейнер;<br>COMMAND: Команда, которая выполняется внутри контейнера;<br>CREATED: Время, прошедшее с момента создания контейнера.<br>STATUS: Текущий статус контейнера (например, “Up 5 seconds”, “Exited (0) 2 hours ago”).<br>PORTS: Опубликованные порты (если есть)<br>NAMES: Имя контейнера (заданное пользователем или сгенерированное Docker) |
| docker ps -n [число] | Показывает информацию о последних N созданных контейнерах | Выводы (по умолчанию):<br>CONTAINER ID: Уникальный идентификатор контейнера (хеш);<br>IMAGE: Имя образа, из которого был создан контейнер;<br>COMMAND: Команда, которая выполняется внутри контейнера;<br>CREATED: Время, прошедшее с момента создания контейнера.<br>STATUS: Текущий статус контейнера (например, “Up 5 seconds”, “Exited (0) 2 hours ago”).<br>PORTS: Опубликованные порты (если есть)<br>NAMES: Имя контейнера (заданное пользователем или сгенерированное Docker) |
| docker ps -s | Выводит размеры контейнеров | Выводы (по умолчанию):<br>CONTAINER ID: Уникальный идентификатор контейнера (хеш);<br>IMAGE: Имя образа, из которого был создан контейнер;<br>COMMAND: Команда, которая выполняется внутри контейнера;<br>CREATED: Время, прошедшее с момента создания контейнера.<br>STATUS: Текущий статус контейнера (например, “Up 5 seconds”, “Exited (0) 2 hours ago”).<br>PORTS: Опубликованные порты (если есть)<br>NAMES: Имя контейнера (заданное пользователем или сгенерированное Docker) |
| docker inspect | Отображает подробную информацию о контейнере | Вывод будет в формате JSON и содержать подробные сведения о контейнере:<br>ID: ID контейнера;<br>Name: имя контейнера;<br>Image: ID образа;<br>Config: конфигурация контейнера (команда, переменные окружения, порты и т.д.);<br>State: текущее состояние контейнера (статус, запущен или нет, код выхода и т.д.). Ключевое поле Status здесь показывает текущий статус;<br>NetworkSettings: настройки сети (IP-адреса, порты и т.д.);<br>Mounts: информация о примонтированных томах (volumes) и дополнительная информация |
| docker logs | Просматривает журналы контейнера | Формат логов внутри контейнера определяется самим приложением. Docker logs просто извлекает этот вывод |
| docker events | Просматривает события Docker, включая изменения состояния контейнеров. | Формат вывода по умолчанию:<br>time: время события (Unix timestamp).<br>timeNano: время события в наносекундах.<br>status: тип события (например: start, stop, create, destroy).<br>id: ID объекта, к которому относится событие (например, ID контейнера или ID образа).<br>from: имя образа (если событие связано с образом).<br>Type: тип ресурса, к которому относится событие (например, container, image, network).<br>Action: действие, которое произошло (например: start, stop, create, destroy);<br>Actor: объект, который является источником события;<br>scope: область действия события (local или swarm) |
| docker ps --format | Позволяет настроить формат вывода. Выводит только выбранную информацию, например, ID и имена контейнеров | Формат вывода определяется шаблоном, указанным в кавычках после --format.<br>Основные доступные поля:<br>.ID: ID контейнера.<br>.Image: имя образа.<br>.Command: команда, выполняющаяся внутри контейнера.<br>.CreatedAt: время создания контейнера (в формате RFC3339).<br>.RunningFor: время, в течение которого контейнер работает (например, 2 minutes ago).<br>.Ports: опубликованные порты.<br>.Names: имена контейнеров.<br>.Labels: метки (labels) контейнера.<br>.Mounts: информация о примонтированных томах.<br>.State: текущее состояние контейнера (например, running, exited).<br>.Status: статус контейнера (например, Up 5 seconds, Exited (0) 2 hours ago).<br>.Size: размер контейнера (с дисками и без дисков) |
| docker ps --filter | Фильтрует вывод по определенным критериям. | Формат вывода идентичен стандартному формату docker ps (или тому, который задан с помощью --format), но отображаются только контейнеры, удовлетворяющие условиям фильтра.<br>Колонки:<br>CONTAINER ID;<br>IMAGE;<br>COMMAND;<br>CREATED;<br>STATUS;<br>PORTS, NAMES |

### Хранение постоянных данных

Для обеспечения сохранности данных при перезапуске, обновлении или удалении контейнеров используется механизм томов Docker (Docker volumes). Эти тома создаются при первоначальной установке Комплекса (см. раздел 4.1.4). В рамках мониторинга и диагностики важно отслеживать их текущее состояние, объем занятого пространства, а также корректность подключения к контейнерам. Повреждение данных в этих томах может привести к полной или частичной недоступности функций Комплекса.

Для диагностики постоянных хранилищ необходимо понимать правильное назначение томов в Комплексе. Их перечень с описанием представлен в таблице 10.

Таблица 10 – Назначение томов Docker


| Название тома | Назначение |
| ------------- | ---------- |
| code | Хранение исходного кода программного обеспечения Комплекса |
| content | Сохранение пользовательского контента (загруженные файлы, изображения, документы и др.) |
| rosa_postgres | Хранилище данных СУБД PostgreSQL. Обеспечивает сохранность при перезапуске контейнера |
| rosa_redis | Хранение данных Redis при включенной персистентности |
| rosa_typesense | Сохранение индексов и данных поискового движка Typesense |
| themes | Хранение тем оформления интерфейса и веб-страниц, созданных в CMS |

> _Примечание_ – В отличие от раздела 4.1.4. Подготовка постоянного хранилища в данной таблице представлены все фактически используемые тома, включая content, rosa_postgres, rosa_redis и rosa_typesense.

Рекомендации по мониторингу томов Docker:

Проверка наличия и статуса томов. Для получения списка всех созданных томов использовать команду:

```bash
docker volume ls
```

Мониторинг объема хранилища. Для оценки занятого пространства можно использовать команды:

```bash
docker system df -v
```

или:

```bash
docker inspect <имя_тома>
```

В выводах команды следует обратить внимание на поле Size.

Настройка регулярного резервного копирования критичных томов, особенно:

rosa_postgres — база данных;

content — пользовательские файлы;

code; themes — конфигурации и визуальное оформление.

### Рекомендации по мониторингу состояния Комплекса

Для обеспечения стабильной работы Комплекса рекомендуется настроить постоянный мониторинг его компонентов с использованием специализированного программного обеспечения. В качестве базового решения может быть использована система мониторинга Zabbix () — свободно распространяемое ПО с открытым исходным кодом, лицензированное под GNU AGPLv3.

### Архитектура системы мониторинга

Для корректной работы Zabbix необходимо развертывание двух основных компонентов:

сервер мониторинга — устанавливается на отдельный сервер под управлением *nix-системы. Отвечает за сбор, обработку и хранение данных мониторинга.

Zabbix-агент — устанавливается на сервер, на котором размещён Комплекс. Отправляет серверу мониторинга данные о состоянии ОС и служб.

Рекомендуется настроить оповещения по электронной почте или в мессенджере (например, Telegram) при возникновении сбоев или достижении критических значений.

### Мониторинг серверной инфраструктуры

Мониторинг должен охватывать как общесистемные показатели, так и состояния ключевых сервисов, входящих в состав Комплекса. В таблице 11 приведён перечень служб и их состояний для отслеживания.

Таблица 11 – Список служб и их метрик


| Отслеживаемые службы | Состояния метрик |
| -------------------- | ---------------- |
| Операционная система | Отсутствие соединения с агентом Zabbix;<br>Неактивность обязательных служб;<br>Нехватка свободного места на диске;<br>Недостаток свободной оперативной памяти;<br>Высокая нагрузка на дисковую подсистему;<br>Высокая нагрузка на оперативную память;<br>Перегрузка сетевого интерфейса;<br>Иные параметры, критически влияющие на работоспособность Комплекса |
| Служба Docker | Отсутствие сведений о статусе Docker;<br>Служба Docker не запущена;<br>Изменение версии Docker;<br>Ошибки в статусе контейнеров;<br>Аварийное завершение контейнеров (exit code ≠ 0);<br>Перегрузка процессора службой Docker;<br>Повышенное потребление памяти службой Docker |
| Traefik | Недоступность службы;<br>Неактивность процесса;<br>Изменение версии;<br>Повышенная загрузка CPU или RAM |
| Nginx | Недоступность службы;<br>Неактивность процесса;<br>Изменение версии;<br>Перегрузка по CPU или RAM;<br>Рост количества ошибок (4XX, 5XX);<br>Превышение лимитов по соединениям и отклику |
| PHP-FPM | Недоступность или остановка службы;<br>Изменение версии;<br>Перегрузка процессора или памяти;<br>Превышение лимитов:<br>активных и idle процессов;<br>соединений в секунду;<br>медленных запросов;<br>очередей подключений |
| Redis | Недоступность службы;<br>Неактивность процесса;<br>Изменение версии;<br>Повышенная нагрузка на CPU или RAM;<br>Превышение лимитов по соединениям, процессам, очередям, медленным операциям |
| PostgreSQL | Отсутствие доступа к службе;<br>Служба неактивна;<br>Изменение версии;<br>Повышенное использование CPU или RAM;<br>Превышение лимитов подключений, активных процессов, частоты запросов |
| Typesense | Отсутствие информации о состоянии службы;<br>Служба не запущена.;<br>Изменение версии;<br>Перегрузка по CPU или памяти |

### Мониторинг доступности веб-интерфейса

Необходимо регулярно проверять доступность и корректность отображения ключевых страниц Портала разработчика:

главная страница;

панель управления администратора;

ошибки 4XX и 5XX на любых страницах;

Рекомендуется использовать внешние проверки (например, через HTTP-мониторинг Zabbix или специализированные скрипты), чтобы контролировать отклик и корректность работы Комплекса как с точки зрения пользователя, так и администратора.
