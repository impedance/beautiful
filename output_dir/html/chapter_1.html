<h1>4 Установка и запуск комплекса</h1>Установка Комплекса осуществляется на сервер, соответствующий требованиям по аппаратному обеспечению и программной совместимости, указанным в разделах 3.1 и 3.2 соответственно.Развёртывание компонентов комплекса производится с использованием технологии контейнеризации (Docker). Все основные серверные компоненты функционируют внутри контейнеров, сборка и запуск которых выполняются с применением системы Docker Compose.Для обеспечения корректной работы Комплекса необходимо предварительно установить и настроить программное окружение, а также выполнить развёртывание вспомогательных сервисов, обеспечивающих маршрутизацию и хранение данных.В стандартной конфигурации требуемые программные компоненты разворачиваются автоматически внутри контейнеров, сборка которых производится из подготовленных сценариев из GitLab CI/CD.Рекомендуется производить установку в пределах арендованной облачной инфраструктуры, организованной по модели IaaS. При этом обеспечивается требуемая степень изоляции, управляемости и масштабируемости среды исполнения Комплекса.<h2>4.1 Развёртывание программного окружения</h2><h3>4.1.1 Установка среды контейнеризации Docker</h3>Перед запуском контейнеров необходимо установить и настроить систему контейнеризации Docker. Для этого нужно выполнить следующие шаги:Установить пакеты docker и docker-compose из репозиториев ОС:sudo dnf install docker docker-composeУбедиться, что установка завершена без ошибок.Включить автоматический запуск службы Docker при загрузке ОС:sudo systemctl enable --now docker.serviceПроверить работоспособность среды запуска контейнеров командой:sudo docker run hello-worldОжидаемый результат – информационное сообщение об успешной работе Docker.<h3>4.1.2 Развёртывание маршрутизатора входящих запросов Traefik</h3>Для обработки входящих HTTP(S)-запросов, <a id="_Hlk199838385"></a>терминации TLS-соединений и маршрутизации трафика между контейнерами используется сервис Traefik.Подготовка конфигурационных файловДля установки сервиса Traefik необходимо подготовить файл docker-compose.yaml со следующим содержанием:version: '3'services:  reverse-proxy:    image: traefik:v3.3.2    restart: always    command:      - --api.insecure=true      - --providers.docker      - --entrypoints.websecure.address=:443      - --entrypoints.web.address=:80      - --entryPoints.web.http.redirections.entryPoint.to=websecure      - --entryPoints.web.http.redirections.entryPoint.scheme=https      - --certificatesresolvers.le.acme.email=<LE info email>      - --certificatesresolvers.le.acme.storage=/acme.json      - --certificatesresolvers.le.acme.tlschallenge=true      - --api      - --providers.file.filename=/opt/traefik/traefik.yml      - --providers.docker.exposedByDefault=false      - --providers.docker.network=traefik_default    ports:      - "80:80"      - "443:443"    volumes:      - /var/run/docker.sock:/var/run/docker.sock      - /var/acme.json:/acme.json      - /opt/devstg.rosa.ru/traefik:/opt/traefik    labels:      - "traefik.enable=true"      - "traefik.http.routers.traefik.rule=Host(`<TRAEFIK\ DASHBOARD URL>`)"      - "traefik.http.routers.traefik.service=api@internal"      - "traefik.http.routers.traefik.middlewares=admin"      - "traefik.http.routers.traefik.tls.certresolver=le"      - "traefik.http.routers.traefik.entrypoints=websecure"      - "traefik.http.middlewares.admin.basicauth.users=<ADMIN USER>:<HASHED PASS>"      - "traefik.http.middlewares.compress.compress=true"где необходимо заменить следующие переменные:<ul><li>&lt;LE info email&gt; — адрес электронной почты для получения уведомлений от файла хранения данных Let's Encrypt;</li><li>&lt;TRAEFIK DASHBOARD URL&gt; — адрес веб-интерфейса Traefik;</li><li>&lt;ADMIN USER&gt; — логин администратора;</li><li>&lt;HASHED PASS&gt; — хеш пароля (формирование описано в официальной документации: <a href="https://doc.traefik.io/traefik/middlewares/http/basicauth/">https://doc.traefik.io/traefik/middlewares/http/basicauth/</a>).</li></ul><p>Создание вспомогательных файловДалее необходимо подготовить файлы на сервере для работы сервиса Traefik:Создать служебный файл для хранения данных Let's Encrypt:sudo touch /var/acme.jsonsudo chmod 600 /var/acme.jsonСоздать структуру директорий /opt/devstg.rosa.ru/traefik/ssl/ и разместить в ней TLS-сертификат и закрытый ключ. Структура новой директории представлена ниже (рисунок 1 ).</p><ul><li><img src="data:image/png;base64,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"/></li></ul><p><a id="_Ref200390262"></a>Рисунок <a id="рис1"></a><a id="_Ref200390270"></a>1 – Пример структуры директории /opt/devstg.rosa.ru/traefik/ssl/Создать конфигурационный файл /opt/devstg.rosa.ru/traefik/traefik.yml:tls:  certificates:    - certFile: /opt/traefik/ssl/cert.pem      keyFile: /opt/traefik/ssl/key.pem      stores:        - defaultПодробности о работе с TLS-сертификатами приведены в официальной документации разработчиков сервиса: <a href="https://doc.traefik.io/traefik/https/tls/">https://doc.traefik.io/traefik/https/tls/</a>Запуск сервисаЗатем необходимо запустить сервис Traefik из директории с файлом docker-compose.yaml:sudo docker compose up -d --force-recreate<strong>Следует убедиться</strong>, что запуск завершён без ошибок. Проверить статус контейнера можно командой:sudo docker psПосле запуска сервиса Traefik нужно зайти в его дашборд по адресу &lt;TRAEFIK DASHBOARD URL&gt; и убедиться в доступности веб-интерфейса маршрутизатора.</p><h3>4.1.3 Установка и подготовка PostgreSQL</h3>Для установки СУБД PostgreSQL и ее первоначальной настройки для работы с Комплексом требуется выполнить следующие шаги:Установить PostgreSQL с помощью команды:sudo apt install postgresqlПолучить последнюю версию СУБД с помощью следующих команд:sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt/ `lsb_release -cs`-pgdg\ main" >> /etc/apt/sources.list.d/pgdg.list'wget -q https://www.postgresql.org/media/keys/ACCC4CF8.asc\ -O - | sudo apt-key add -sudo apt-get install postgresqlСоздать базу данных для Комплекса:createdb wbii_statПодключиться к СУБД:sudo supsqlСоздать отдельного пользователя и его пароль:CREATE USER wbii WITH PASSWORD 'указать_сложный_пароль';GRANT ALL PRIVILEGES ON DATABASE wbii_stat TO wbii;где в первой строке необходимо задать пароль для пользователя.Пароль должен состоять минимум из 12 символов, включать строчные и прописные латинские буквы, цифры, знаки препинания и специальные символы. Пробелы использовать запрещено.<h3>4.1.4 Подготовка постоянного хранилища</h3>Для обеспечения долговременного хранения данных необходимо создать тома Docker (Docker volume), в которых будут размещаться:<ul><li>журналы работы (logs);</li><li>файлы приложения (app);</li><li>темы оформления интерфейса (themes);</li><li>исходный код и конфигурации (code).</li></ul><p>Том Docker volume представляет собой область на диске хост-системы, которая может быть подключена к одному или нескольким контейнерам. Данные, размещённые в Docker volume, не теряются при пересоздании контейнера, что делает его основным инструментом для хранения постоянной информации.Создание томов осуществляется следующими командами:sudo docker volume create storage_logssudo docker volume create storage_appsudo docker volume create themessudo docker volume create codeДалее следует убедиться в успешном создании томов Docker с помощью команды:docker volume lsДанная команда выведет список всех созданных Docker-томов. В результате в списке должны появиться тома с именами:</p><ul><li>storage_logs;</li><li>storage_app;</li><li>themes;</li><li>code.</li></ul><p></p><h2>4.2 Установка Комплекса</h2>Запуск Комплекса осуществляется с использованием системы CI/CD, настроенной в инфраструктуре GitLab, размещённой по адресу: https://git.rosa.ru/Установка Портала разработчика выполняется следующими командами:git checkout <название_ветки>git pullphp artisan winter:upгде необходимо заменить параметр <название_ветки>:<ul><li>ветки с именами rc_ХХ автоматически ассоциируются с тестовым контуром;</li><li>ветка release предназначена для развертывания в промышленной среде.</li></ul><p></p><h2>4.3 Запуск Комплекса</h2><h3>4.3.1 Загрузка через командную строку</h3>В штатном режиме работа Комплекса начинается автоматически при загрузке операционной системы. В случае необходимости запуска вручную требуется выполнить команды:systemctl start postgresqlsystemctl start apache2Для запуска отдельных компонентов Комплекса вручную следует использовать следующие команды:report/moralprep/index.phpreport/statusrelative/index.phpreport/whitespots/index.phpreport/neuroschedule/index.php<h3>4.3.2 Вход в комплекс</h3>Для начала работы с Комплексом администратору или пользователю необходимо:<ul><li>открыть веб-браузер и перейти по адресу: <a href="https://developer.rosa.ru/">https://developer.rosa.ru/</a>;</li><li>перейти в раздел "Установить" для выбора подходящей ОС;</li><li>запустить процедуру установки программного окружения и компонентов Комплекса;</li><li>пройти процедуру аутентификации.</li></ul><p>После прохождения процедуры аутентификации будет получен полный доступ к интерфейсу и функциям Комплекса.</p>