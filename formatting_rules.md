# Правила форматирования для конвертации DOCX в Markdown

Анализ файлов samples/ выявил следующие паттерны и правила форматирования:

## 1. Структура файлов

### Frontmatter
Каждый файл должен начинаться с YAML frontmatter:
```yaml
---
title: Название главы/раздела
nextRead:         # (опционально)
  to: /путь/к/следующей/странице
  label: Название следующей страницы
---
```

### Основной заголовок
После frontmatter идет заголовок первого уровня, совпадающий с title:
```markdown
# Название главы
```

## 2. Заголовки

### Система нумерации
- H1 (`#`) - основной заголовок главы без номера
- H2 (`##`) - разделы с нумерацией типа "1.1", "2.1", "3.1"
- Формат: `## X.Y Название раздела`

### Примеры:
- `# Общие сведения`
- `## 1.1 Функциональное назначение` 
- `## 2.2 Состав плагинов`

## 3. Специальные блоки

### AppAnnotation блок
Используется для важной информации/аннотаций и визуально выделяется цветным фоном:
```markdown
::AppAnnotation
Текст аннотации может быть многострочным.
Описывает ключевые моменты раздела.
::
```

### Фоновое выделение
- Других видов фонового выделения в образцах не обнаружено;
- Примечания отображаются через `blockquote`, что также создаёт серый фон у текста.

## 4. Списки

### Маркированные списки
- Используется символ `-` (дефис) с пробелом
- Поддерживается многоуровневая вложенность
- Длинные элементы списка могут переноситься на несколько строк

Примеры:
```markdown
- обеспечение разработчиков каталогом документации;
- предоставление примеров фрагментов кода;
- ускорение процессов разработки.
```

### Описательные списки компонентов
Для технических компонентов используется формат:
```markdown
- `Компонент` — описание компонента;
- `Другой компонент` — его описание.
```

## 5. Таблицы

### Стандартные таблицы
```markdown
| Заголовок 1 | Заголовок 2 | Заголовок 3 |
| ----------- | ----------- | ----------- |
| Данные      | Данные      | Данные      |
```

### Таблицы с выравниванием
```markdown
| Левый        | Центр  | Правый |
| :----------- | :----: | -----: |
| Левое        | Центр  | Правое |
```

### Переносы в ячейках
Для переносов строк в ячейках используется `<br>`:
```markdown
| Колонка |
| ------- |
| Строка 1<br>Строка 2<br>Строка 3 |
```

### Группировка строк и пустые ячейки
Для имитации объединённых ячеек используются отдельные строки с заполненной первой колонкой и пустыми остальными:
```markdown
| Браузер       | ОС           | Процессор |
| ------------- | ------------ | --------- |
| Google Chrome |              |           |
| Windows       | Windows 10   | Intel Pentium 4 |
| Linux         | Debian 10    | Intel Pentium 4 |
| Yandex Browser|              |           |
| Windows       | Windows 7    | Intel Pentium 4 |
```

### Подписи к таблицам
После каждой таблицы идет подпись в формате blockquote:
```markdown
> Таблица X – Описание таблицы
```

## 6. Примечания и цитаты

### Примечания
```markdown
> _Примечание_ – Текст примечания.
> Может быть многострочным.
```

### Обычные blockquote
```markdown
> Обычная цитата без специального форматирования
```

## 7. Inline форматирование

### Код
- Используются обратные кавычки для `кода`
- Технические термины и названия ПО: `Winter CMS`, `PostgreSQL`, `Docker`
- Стандарты и языки: `HTML5`, `CSS3`, `JavaScript`
- Многострочных блоков кода в образцах нет

### Акценты
- Курсив для терминов: _Примечание_
- Жирный для важных понятий (редко используется в образцах)

## 8. Ссылки

### Внутренние ссылки
```markdown
[разделе 7](/developer/administrator/winter-cms)
```

## 9. Абзацы и разделение

### Интервалы
- Пустая строка между абзацами
- Пустая строка после заголовков
- Пустая строка после списков
- Пустая строка после таблиц и их подписей

### Длинные абзацы
Абзацы могут быть довольно длинными и содержать несколько предложений без принудительных переносов.

## 10. Обработка изображений

Согласно requirements должны обрабатываться в формате:
```
::sign-image
src: <src>
sign: <sign>
::
```

## 11. Нумерация разделов

### Схема нумерации:
- Глава 1: разделы 1.1, 1.2, 1.3, 1.4
- Глава 2: разделы 2.1, 2.2, 2.3, ..., 2.9
- Глава 3: разделы 3.1, 3.2, 3.3

### В заголовках:
- Номер главы отсутствует в H1
- Номер раздела присутствует в H2
- Подразделы (если есть) будут H3 с тройной нумерацией (например, 3.1.1)

## 12. Консистентность стиля

### Технические термины
- Названия ПО всегда в обратных кавычках
- Аббревиатуры без кавычек: HTML5, CSS3, JavaScript
- Названия стандартов: ISO/IEC 9075:2011

### Пунктуация
- Списки заканчиваются точкой с запятой, последний элемент - точкой
- Описания в списках компонентов заканчиваются точкой с запятой
- В таблицах точки обычно не ставятся

### Языковые особенности
- Документы на русском языке
- Соблюдается официально-деловой стиль
- Используется техническая терминология

---

# ДОПОЛНИТЕЛЬНЫЕ ПРАВИЛА ДЛЯ ИСПРАВЛЕНИЯ ОШИБОК КОНВЕРТАЦИИ

## 13. Проблемы в chapters/ и их исправления

### 13.1 Неправильные уровни заголовков
**ПРОБЛЕМА**: В chapters используются H3 (###) вместо правильных H1 и H2
```markdown
### Общие сведения           ❌ НЕПРАВИЛЬНО
### Назначение              ❌ НЕПРАВИЛЬНО
```

**ПРАВИЛЬНО** (как в samples):
```markdown
# Общие сведения            ✅ H1 для основного заголовка главы
## 1.1 Назначение           ✅ H2 с нумерацией для разделов
```

### 13.2 Отсутствие нумерации разделов
**ПРОБЛЕМА**: В chapters отсутствует нумерация разделов из оригинального документа

Из dev.docx видна правильная структура:
```
# 1 Общие сведения
## 1.1 Назначение
## 1.2 Функции
# 2 Архитектура комплекса  
## 2.1 Основные компоненты
## 2.2 Состав плагинов
# 3 Технические и программные требования
## 3.1 Требования к программному обеспечению
## 3.2 Требования к аппаратному обеспечению
## 3.3 Требования к клиентской части
```

**ПРАВИЛО**: Конвертер должен восстанавливать номера глав и разделов согласно исходной структуре DOCX

### 13.3 Отсутствие AppAnnotation блоков
**ПРОБЛЕМА**: В chapters простой текст вместо AppAnnotation блоков

**НЕПРАВИЛЬНО**:
```markdown
Программный комплекс построен по модульной архитектуре...
```

**ПРАВИЛЬНО**:
```markdown
::AppAnnotation
Программный комплекс "Портал разработчика" построен по модульной архитектуре.
Архитектура реализована на базе Winter CMS и включает серверную часть...
::
```

### 13.4 Неправильное форматирование списков
**ПРОБЛЕМА**: В chapters простые абзацы вместо списков

**НЕПРАВИЛЬНО**:
```markdown
предоставление разработчикам доступа...

размещение готовых примеров...

обеспечение условий для ускоренной разработки...
```

**ПРАВИЛЬНО**:
```markdown
Комплекс реализует следующие основные функции:

- предоставление разработчикам доступа к актуальной документации;
- размещение готовых примеров фрагментов исходного кода;
- обеспечение условий для ускоренной разработки программного обеспечения.
```

### 13.5 Неправильное оформление технических компонентов
**ПРОБЛЕМА**: В chapters простые абзацы вместо списков компонентов

**НЕПРАВИЛЬНО**:
```markdown
CMS-сервер (Winter CMS) — основной элемент серверной части...

плагины Winter CMS — модули, расширяющие функциональность...
```

**ПРАВИЛЬНО**:
```markdown
- `CMS-сервер` (`Winter CMS`) — основной элемент серверной части;
- плагины `Winter CMS` — модули, расширяющие функциональность CMS;
```

### 13.6 Отсутствие правильных таблиц
**ПРОБЛЕМА**: В chapters неправильно структурированные таблицы

Должны быть:
- Правильные заголовки таблиц
- Подписи в формате blockquote
- Правильное выравнивание
- HTML `<br>` для переносов в ячейках

## 14. Алгоритм исправления для конвертера

### 14.1 Восстановление структуры заголовков
1. H1 (`#`) - только для основного заголовка главы (без номера)
2. H2 (`##`) - для пронумерованных разделов (X.Y Название)
3. H3 (`###`) - только для подразделов (если есть)

### 14.2 Восстановление нумерации
Конвертер должен отслеживать структуру документа и присваивать номера:
- Глава 1: разделы 1.1, 1.2, 1.3, 1.4
- Глава 2: разделы 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9
- Глава 3: разделы 3.1, 3.2, 3.3
- И так далее...

### 14.3 Детектирование AppAnnotation блоков
Первые абзацы разделов с описательным характером должны оборачиваться в AppAnnotation:
- Длинные описательные абзацы в начале раздела
- Обзорная информация о назначении/архитектуре
- Ключевые концепции и определения

### 14.4 Детектирование списков
Должны конвертироваться в маркированные списки:
- Последовательности задач/функций/компонентов
- Перечисления требований
- Списки технологий/инструментов

### 14.5 Форматирование frontmatter
Каждый файл должен начинаться с правильного YAML frontmatter:
```yaml
---
title: Точное название главы
nextRead:         # только если есть следующая глава
  to: /путь/к/следующей/главе
  label: Название следующей главы
---
```
